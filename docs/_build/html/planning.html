
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>planning – Route Planning Application &#8212; Navtools 2021.06.01 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="analysis – Track Analysis Application" href="analysis.html" />
    <link rel="prev" title="Overview and Context" href="introduction.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-planning">
<span id="planning-route-planning-application"></span><h1><a class="reference internal" href="#module-planning" title="planning"><code class="xref py py-mod docutils literal notranslate"><span class="pre">planning</span></code></a> – Route Planning Application<a class="headerlink" href="#module-planning" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="#module-planning" title="planning"><code class="xref py py-mod docutils literal notranslate"><span class="pre">planning</span></code></a> application is used to do voyage planning.
It computes range, bearing and elapsed time for points along a route.</p>
<p>Here’s the structure of the classes in this application:</p>
<p class="plantuml">
<img src="_images/plantuml-c391d5f8595dff08ee67e616763dd1b0a9d7a873.png" alt="&#64;startuml
component planning {
    class Waypoint_Rhumb {
        point : Waypoint
    }
    class Waypoint_Rhumb_Magnetic {
        point: Waypoint_Rhumb
    }
    Waypoint_Rhumb_Magnetic *-&gt; Waypoint_Rhumb
    class SchedulePoint {
        point: Waypoint_Rhumb
    }
    SchedulePoint *-&gt; Waypoint_Rhumb
}
component navigation {
    class Waypoint {
        lat: Lat
        lon: Lon
    }
}
Waypoint_Rhumb *-- Waypoint
&#64;enduml"/>
</p>
<section id="planning-approach">
<h2>Planning Approach<a class="headerlink" href="#planning-approach" title="Permalink to this headline">¶</a></h2>
<p>Currently, the planning application computes distances and Estimated Time Enroute (ETE) for each leg.
It does little more than this. The approach is embodied by creating a <code class="xref py py-class docutils literal notranslate"><span class="pre">SchedulePoint</span></code> object.
This is direct enrichment of the <code class="xref py py-class docutils literal notranslate"><span class="pre">Waypoint</span></code> instances along the route.</p>
<p>There are a number of potential improvements to this approach:</p>
<ul class="simple">
<li><p>Include an estimated time of departure (ETD) as a basis for computing ETE and ETA.</p></li>
<li><p>Include the position of the sun for each ETA.</p></li>
<li><p>Include a Noon position on any leg that spans local noon.</p></li>
</ul>
<p>An event more sophisticated planner would allow for two kinds of plans:</p>
<ul class="simple">
<li><p>A “forward” plan uses a Desired Time of Departure (DTD) to compute a sequence of ETE and ETA’s.</p></li>
<li><p>A “reverse” plan would use a Desired Time of Arrival (DTA) and work backwords to
compute departures and times enroute. This would lead to a Desired Time of Departure (DTD).</p></li>
</ul>
<p>The idea is to reduce the amount of work done with a spreadsheet outside <code class="xref py py-mod docutils literal notranslate"><span class="pre">navtools</span></code>.</p>
<section id="improvements">
<h3>Improvements<a class="headerlink" href="#improvements" title="Permalink to this headline">¶</a></h3>
<p>There are several improvements required.</p>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Locate the sunrise equation and include anticipated time-of-day for an ETA</p>
<p>See <a class="reference external" href="https://gml.noaa.gov/grad/solcalc/solareqns.PDF">https://gml.noaa.gov/grad/solcalc/solareqns.PDF</a></p>
</div>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>Compute the locations at noon of each day.</p>
<p>This requires looking at waypoints before and after local noon, Splitting the segment
to find noon, and adding a waypoint with no course change.</p>
</div>
<p>The goal is to match the output content of <code class="xref py py-mod docutils literal notranslate"><span class="pre">opencpn_table</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p>waypoint: Waypoint</p></li>
<li><p>leg: int</p></li>
<li><p>ETE: Optional[“Duration”]</p></li>
<li><p>ETA: Optional[datetime.datetime]</p></li>
<li><p>ETA_summary: Optional[str]</p></li>
<li><p>speed: float</p></li>
<li><p>tide: Optional[str]</p></li>
<li><p>distance: Optional[float]</p></li>
<li><p>bearing: Optional[float]</p></li>
<li><p>course: Optional[float] = None</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>This module includes several groups of components.</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="#planning-input"><span class="std std-ref">Input Parsing</span></a> group is the functions and classes that
acquire input from the GPX or CSV file.</p></li>
<li><p>The <a class="reference internal" href="#planning-computations"><span class="std std-ref">Planning Computations</span></a> functions work out range and bearing, magnetic bearing, total distance run,
and elapsed time in minutes and hours.</p></li>
<li><p>The <a class="reference internal" href="#planning-output"><span class="std std-ref">Output Writing</span></a> group is the functions to write the CSV result.</p></li>
<li><p>Finally, the <a class="reference internal" href="#planning-cli"><span class="std std-ref">Command-Line Interface</span></a> components are used
to build a proper command-line application.</p></li>
</ul>
<span class="target" id="module-navtools.planning"></span></section>
<section id="input-parsing">
<span id="planning-input"></span><h2>Input Parsing<a class="headerlink" href="#input-parsing" title="Permalink to this headline">¶</a></h2>
<p>The purpose of input parsing is to create <code class="xref py py-class docutils literal notranslate"><span class="pre">Waypoint</span></code> objects
from input file sources.</p>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">Waypoint</span></code> is a 5-tuple of name, latitude, longitude, description
and “point” information.   The “point” information is a
<code class="xref py py-class docutils literal notranslate"><span class="pre">navigation.LatLon</span></code> instance that combines the source lat and lon
values.</p>
<p>The input parsing supports two formats: CSV and GPX.  Each source format has
a different kind of parser.  The CSV parser uses the <code class="xref py py-mod docutils literal notranslate"><span class="pre">csv</span></code> module.  The GPX parser uses
<code class="xref py py-mod docutils literal notranslate"><span class="pre">xml.etree</span></code>; it uses the <code class="docutils literal notranslate"><span class="pre">findall()</span></code> method to iterate
through all of the rows.</p>
<p>Note that the GPSNavX output was encoded in <code class="docutils literal notranslate"><span class="pre">Western</span> <span class="pre">(Mac</span> <span class="pre">OS</span> <span class="pre">Roman)</span></code>.
This can make CSV parsing a bit more complex because there will be
Unicode characters that the CSV module doesn’t always handle gracefully.
However, the patterns used for parsing tolerate the extraneous bytes
that appear in the midst of degree-minute values.</p>
<dl class="py function">
<dt class="sig sig-object py" id="navtools.planning.csv_to_Waypoint">
<span class="sig-prename descclassname"><span class="pre">navtools.planning.</span></span><span class="sig-name descname"><span class="pre">csv_to_Waypoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">TextIO</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">navtools.navigation.Waypoint</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#navtools.planning.csv_to_Waypoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses the CSV files produced by tools like GPSNavX or iNavX
to yield an iterable sequence of <code class="xref py py-class docutils literal notranslate"><span class="pre">Waypoint</span></code> objects.
These files had no heading row.
The assumed column order is “name”, “lat”, “lon”, “description”.</p>
<p>Note that the old GPSNavX output was encoded in <code class="docutils literal notranslate"><span class="pre">Western</span> <span class="pre">(Mac</span> <span class="pre">OS</span> <span class="pre">Roman)</span></code>.
This can make CSV parsing a bit more complex because there will be
Unicode characters that the CSV module doesn’t always handle gracefully.
However, the patterns used for parsing tolerate the extraneous bytes
that appear in the midst of degree-minute values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>source</strong> – Open file or file-like object that can be read</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>iterable sequence of <code class="xref py py-class docutils literal notranslate"><span class="pre">Waypoint</span></code> instances.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="navtools.planning.gpx_to_Waypoint">
<span class="sig-prename descclassname"><span class="pre">navtools.planning.</span></span><span class="sig-name descname"><span class="pre">gpx_to_Waypoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">TextIO</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><span class="pre">navtools.navigation.Waypoint</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#navtools.planning.gpx_to_Waypoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates <code class="xref py py-class docutils literal notranslate"><span class="pre">Waypoint</span></code> onjects from a GPX doc.</p>
<p>We assume a minimal schema:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;rte&gt;</span></code> contains</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;rtept</span> <span class="pre">lat=&quot;&quot;</span> <span class="pre">lon=&quot;&quot;&gt;</span></code> contains</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;description&gt;</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>In some cases, there are additional attributes available, but we
don’t seem to need them for planning.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>source</strong> – an open GPX file.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An iterator over <code class="xref py py-class docutils literal notranslate"><span class="pre">Waypoint</span></code> objects.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="planning-computations">
<span id="id3"></span><h2>Planning Computations<a class="headerlink" href="#planning-computations" title="Permalink to this headline">¶</a></h2>
<p>The various navigation calculations use an immutable object (or functional
programming) style.  A series of functions create new, richer objects
from the initial <code class="xref py py-class docutils literal notranslate"><span class="pre">Waypoint</span></code> objects.</p>
<p>Specifically, we use the following kind of function composition.</p>
<p class="plantuml">
<img src="_images/plantuml-781ed72881051ca8b7be7b1be48feebf92f696b9.png" alt="&#64;startuml
start
switch (format?)
case ( CSV )
    :route = csv_to_Waypoint;
case ( GPX )
    :route = gpx_to_Waypoint;
endswitch
:gen_schedule;
:write_csv;
stop
&#64;enduml"/>
</p>
<section id="schedule-details">
<h3>Schedule Details<a class="headerlink" href="#schedule-details" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="navtools.planning.SchedulePoint">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">navtools.planning.</span></span><span class="sig-name descname"><span class="pre">SchedulePoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">point</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">navtools.navigation.Waypoint</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">true_bearing</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="navigation.html#navtools.navigation.Angle" title="navtools.navigation.Angle"><span class="pre">navtools.navigation.Angle</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">magnetic</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="navigation.html#navtools.navigation.Angle" title="navtools.navigation.Angle"><span class="pre">navtools.navigation.Angle</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">speed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enroute_min</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">next_course</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="navigation.html#navtools.navigation.Angle" title="navtools.navigation.Angle"><span class="pre">navtools.navigation.Angle</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arrival</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">datetime.datetime</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#navtools.planning.SchedulePoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Scheduled waypoints.
These include distance, bearing, and estimated time enroute (ETE).</p>
<div class="admonition-todo admonition" id="id4">
<p class="admonition-title">Todo</p>
<p>Unify with <code class="xref py py-class docutils literal notranslate"><span class="pre">opencpn_table.Leg</span></code>.</p>
<ul class="simple">
<li><p>leg: int</p></li>
<li><p>ETE: Optional[“Duration”]</p></li>
<li><p>ETA: Optional[datetime.datetime]</p></li>
<li><p>ETA_summary: Optional[str]</p></li>
<li><p>speed: float</p></li>
<li><p>tide: Optional[str]</p></li>
<li><p>distance: Optional[float]</p></li>
<li><p>bearing: Optional[float]</p></li>
<li><p>course: Optional[float] = None</p></li>
</ul>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.planning.SchedulePoint.point">
<span class="sig-name descname"><span class="pre">point</span></span><em class="property"><span class="pre">:</span> <span class="pre">navtools.navigation.Waypoint</span></em><a class="headerlink" href="#navtools.planning.SchedulePoint.point" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.planning.SchedulePoint.distance">
<span class="sig-name descname"><span class="pre">distance</span></span><em class="property"><span class="pre">:</span> <span class="pre">float</span></em><a class="headerlink" href="#navtools.planning.SchedulePoint.distance" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.planning.SchedulePoint.true_bearing">
<span class="sig-name descname"><span class="pre">true_bearing</span></span><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="navigation.html#navtools.navigation.Angle" title="navtools.navigation.Angle"><span class="pre">navtools.navigation.Angle</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#navtools.planning.SchedulePoint.true_bearing" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.planning.SchedulePoint.magnetic">
<span class="sig-name descname"><span class="pre">magnetic</span></span><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="navigation.html#navtools.navigation.Angle" title="navtools.navigation.Angle"><span class="pre">navtools.navigation.Angle</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#navtools.planning.SchedulePoint.magnetic" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.planning.SchedulePoint.speed">
<span class="sig-name descname"><span class="pre">speed</span></span><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#navtools.planning.SchedulePoint.speed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.planning.SchedulePoint.enroute_min">
<span class="sig-name descname"><span class="pre">enroute_min</span></span><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#navtools.planning.SchedulePoint.enroute_min" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.planning.SchedulePoint.next_course">
<span class="sig-name descname"><span class="pre">next_course</span></span><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="navigation.html#navtools.navigation.Angle" title="navtools.navigation.Angle"><span class="pre">navtools.navigation.Angle</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#navtools.planning.SchedulePoint.next_course" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.planning.SchedulePoint.arrival">
<span class="sig-name descname"><span class="pre">arrival</span></span><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">datetime.datetime</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#navtools.planning.SchedulePoint.arrival" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="navtools.planning.gen_schedule">
<span class="sig-prename descclassname"><span class="pre">navtools.planning.</span></span><span class="sig-name descname"><span class="pre">gen_schedule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">waypoints</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">navtools.navigation.Waypoint</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variance</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="navigation.html#navtools.navigation.LatLon" title="navtools.navigation.LatLon"><span class="pre">navtools.navigation.LatLon</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">datetime.date</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_datetime</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">datetime.datetime</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">speed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">5.0</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#navtools.planning.SchedulePoint" title="navtools.planning.SchedulePoint"><span class="pre">navtools.planning.SchedulePoint</span></a><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#navtools.planning.gen_schedule" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates distance, bearing, and time en route for each waypoint.
This is the forward algorithm starting from start_datetime.</p>
<p>The algorithm peeks ahead to compute the course to the next waypoint.
This requires a route with two or more waypoints.</p>
<p>It works like this:</p>
<ul class="simple">
<li><p>Set previous = next(iter); here = next(iter)</p></li>
<li><p>Yield previous with no ETE or distance, course from previous to here.</p></li>
<li><p>For end in iter:</p>
<ul>
<li><p>Compute ETE and distance from previous to here</p></li>
<li><p>Yield here with ETE and distance from previous to here and course from here to end.</p></li>
<li><p>Set previous, here = here, end; with some cleverness, we should be able to reuse distance and bearing.</p></li>
</ul>
</li>
<li><p>Compute ETE and distance from previous to here</p></li>
<li><p>Yield here with ETE and course from previous to here and no course.</p></li>
</ul>
<p>This requires a wee bit of optimization to prevent duplicate cade.
We should, specifically, cache the distance and bearing to avoid recomputation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>waypoints</strong> – Iterable collection of <code class="xref py py-class docutils literal notranslate"><span class="pre">Waypoint</span></code> objects.</p></li>
<li><p><strong>variance</strong> – the magnetic variance (a/k/a declination) function;
generally use <code class="xref py py-func docutils literal notranslate"><span class="pre">navigation.declination()</span></code>.</p></li>
<li><p><strong>start_datetime</strong> – the date on which to compute the variance; default is today</p></li>
<li><p><strong>speed</strong> – Default speed assumption to use; default is 5.0 knots.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>iterator over <a class="reference internal" href="#navtools.planning.SchedulePoint" title="navtools.planning.SchedulePoint"><code class="xref py py-class docutils literal notranslate"><span class="pre">SchedulePoint</span></code></a> instances.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="output-writing">
<span id="planning-output"></span><h2>Output Writing<a class="headerlink" href="#output-writing" title="Permalink to this headline">¶</a></h2>
<p>Writes a sequence of <code class="xref py py-class docutils literal notranslate"><span class="pre">Schedule</span></code> objects to a given target file.</p>
<p>The file will have the following columns:</p>
<blockquote>
<div><p>“Name”, “Lat”, “Lon”, “Desc”,
“Distance (nm)”, “True Bearing”, “Magnetic Bearing”,
“Distance Run”, “Elapsed HH:MM”</p>
</div></blockquote>
<p>Note that we apply some rounding rules to these values before writing them
to a CSV file. The distances are rounded to <span class="math notranslate nohighlight">\(10^{-5}\)</span> which is about
an inch, or 2 cm more accurate than the GPS position.
The bearing is rounded to zero places.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It’s hard to steer to a given degree,
much less a fraction of a degree. Classically, the mariner’s compass divides
the circle into 32 points; this is 12.5 degrees each point. That’s an appropriate rounding
for coastal cruising.</p>
<p>The width of your fist at arm’s length is 10°. If you extend index finger and pinky,
that’s 15°. In the middle is all the accuracy you have when steering by hand.</p>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="navtools.planning.nround">
<span class="sig-prename descclassname"><span class="pre">navtools.planning.</span></span><span class="sig-name descname"><span class="pre">nround</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">digits</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#navtools.planning.nround" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a rounded value, properly honoring <code class="docutils literal notranslate"><span class="pre">None</span></code> objects.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>value</strong> – Float value (or None)</p></li>
<li><p><strong>digits</strong> – number of digits</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>rounded float value (or None)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="navtools.planning.write_csv">
<span class="sig-prename descclassname"><span class="pre">navtools.planning.</span></span><span class="sig-name descname"><span class="pre">write_csv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">TextIO</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sched_iter</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#navtools.planning.SchedulePoint" title="navtools.planning.SchedulePoint"><span class="pre">navtools.planning.SchedulePoint</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#navtools.planning.write_csv" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes a sequence of <code class="xref py py-class docutils literal notranslate"><span class="pre">Schedule</span></code> objects to a given target file.</p>
<p>The file has the following columns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Lat&quot;</span><span class="p">,</span> <span class="s2">&quot;Lon&quot;</span><span class="p">,</span> <span class="s2">&quot;Desc&quot;</span><span class="p">,</span>
<span class="s2">&quot;Distance (nm)&quot;</span><span class="p">,</span> <span class="s2">&quot;True Bearing&quot;</span><span class="p">,</span> <span class="s2">&quot;Magnetic Bearing&quot;</span><span class="p">,</span>
<span class="s2">&quot;Distance Run&quot;</span><span class="p">,</span> <span class="s2">&quot;Elapsed HH:MM&quot;</span>
</pre></div>
</div>
<p>It makes sense to unify the output with OpenCPN’s plan.
This leads to the following columns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Leg&quot;</span> <span class="o">--</span> <span class="n">sequence</span> <span class="n">number</span> <span class="n">of</span> <span class="n">legs</span><span class="o">.</span>
<span class="s2">&quot;To waypoint&quot;</span> <span class="o">--</span> <span class="n">Waypoint</span> <span class="n">name</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">GPX</span> <span class="n">source</span>
<span class="s2">&quot;Distance&quot;</span> <span class="o">--</span> <span class="n">Equirectangular</span> <span class="n">distance</span> <span class="n">to</span> <span class="n">the</span> <span class="n">waypoint</span><span class="o">.</span>
<span class="s2">&quot;True Bearing&quot;</span> <span class="o">--</span> <span class="kc">True</span><span class="o">-</span><span class="n">North</span> <span class="n">Bearting</span>
<span class="s2">&quot;Bearing&quot;</span> <span class="o">--</span> <span class="n">Magnetic</span> <span class="n">bearing</span> <span class="p">(</span><span class="k">with</span> <span class="n">decliation</span><span class="o">.</span><span class="p">)</span>
<span class="s2">&quot;Latitude&quot;</span> <span class="o">--</span> <span class="n">Waypoint</span> <span class="n">latitude</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">GPX</span> <span class="n">source</span>
<span class="s2">&quot;Longitude&quot;</span> <span class="o">--</span> <span class="n">Waypoint</span> <span class="n">longitude</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">GPX</span> <span class="n">source</span>
<span class="s2">&quot;ETE&quot;</span> <span class="o">--</span> <span class="n">Estimated</span> <span class="n">Time</span> <span class="n">Enroute</span> <span class="ow">in</span> <span class="s2">&quot;d h m&quot;</span> <span class="n">duration</span> <span class="nb">format</span><span class="o">.</span>
<span class="s2">&quot;ETA&quot;</span> <span class="o">--</span> <span class="n">Estimated</span> <span class="n">time</span> <span class="n">of</span> <span class="n">arrival</span> <span class="k">as</span> <span class="s2">&quot;date hh:mm (summary)&quot;</span>
<span class="s2">&quot;Speed&quot;</span> <span class="o">--</span> <span class="n">Given</span> <span class="n">speed</span> <span class="k">for</span> <span class="n">this</span> <span class="n">leg</span> <span class="p">(</span><span class="n">usually</span> <span class="n">it</span><span class="s1">&#39;s all one assumed speed.)</span>
<span class="s2">&quot;Next tide event&quot;</span> <span class="o">--</span> <span class="n">usually</span> <span class="n">empty</span>
<span class="s2">&quot;Description&quot;</span> <span class="o">--</span> <span class="n">Waypoint</span> <span class="n">description</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">GPX</span> <span class="n">source</span>
<span class="s2">&quot;Course&quot;</span> <span class="o">--</span> <span class="n">Course</span> <span class="n">to</span> <span class="n">steer</span> <span class="n">to</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">waypoint</span>
</pre></div>
</div>
<p>Note that we apply some rounding rules to some values before writing them
to a CSV file. The distances are rounded to <span class="math notranslate nohighlight">\(10^{-1}\)</span> which is about 607’.
The bearing is rounded to zero places.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target</strong> – Open file (or file-like object) to which csv data will be
written.</p></li>
<li><p><strong>sched_iter</strong> – iterator over <a class="reference internal" href="#navtools.planning.SchedulePoint" title="navtools.planning.SchedulePoint"><code class="xref py py-class docutils literal notranslate"><span class="pre">SchedulePoint</span></code></a> instances.
For example, the output from the <a class="reference internal" href="#navtools.planning.gen_schedule" title="navtools.planning.gen_schedule"><code class="xref py py-func docutils literal notranslate"><span class="pre">gen_schedule()</span></code></a> function.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="command-line-interface">
<span id="planning-cli"></span><h2>Command-Line Interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h2>
<p>Typical use cases for this module include the following.</p>
<ul>
<li><p>Run from the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python -m navtools.planning -s <span class="m">5</span>.0 <span class="s1">&#39;../../Sailing/Cruising Plans/Lewes 2011/Jackson Creek to Cape Henlopen -- Offshore.gpx&#39;</span>
</pre></div>
</div>
</li>
<li><p>Run within a Python script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">navtools.planning</span> <span class="kn">import</span> <span class="n">plan</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="n">routes</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/path/to/routes&quot;</span><span class="p">)</span>
<span class="n">plan</span><span class="p">(</span><span class="n">routes</span><span class="o">/</span><span class="s1">&#39;Whitby Rendezvous.csv&#39;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
<span class="n">plan</span><span class="p">(</span><span class="n">routes</span><span class="o">/</span><span class="s1">&#39;Whitby Rendezvous.gpx&#39;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<section id="the-plan-application">
<h3>The <a class="reference internal" href="#navtools.planning.plan" title="navtools.planning.plan"><code class="xref py py-func docutils literal notranslate"><span class="pre">plan()</span></code></a> application<a class="headerlink" href="#the-plan-application" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="navtools.planning.plan">
<span class="sig-prename descclassname"><span class="pre">navtools.planning.</span></span><span class="sig-name descname"><span class="pre">plan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">route_path</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pathlib.Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">speed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">departure</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">datetime.datetime</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variance</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="navigation.html#navtools.navigation.LatLon" title="navtools.navigation.LatLon"><span class="pre">navtools.navigation.LatLon</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">datetime.date</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#navtools.planning.plan" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms a simple route into a route with a detailed schedule.</p>
<p>This doesn’t compute ETA’s. It computes ETE’s for each leg, and
an assumed start time can be plugged in to create ETA’s.</p>
<p>The date is used to compute variance, but not to compute ETA’s.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>route_filename</strong> – Source route, extracted into CSV format.</p></li>
<li><p><strong>speed</strong> – Assumed speed; default is 5.0kn.</p></li>
<li><p><strong>date</strong> – Assumed date for magnetic declination; default is today.</p></li>
<li><p><strong>variance</strong> – Declination function to use.  Default is <code class="xref py py-func docutils literal notranslate"><span class="pre">navigation.declination()</span></code></p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="the-main-cli">
<h3>The <a class="reference internal" href="#navtools.planning.main" title="navtools.planning.main"><code class="xref py py-func docutils literal notranslate"><span class="pre">main()</span></code></a> CLI<a class="headerlink" href="#the-main-cli" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="navtools.planning.main">
<span class="sig-prename descclassname"><span class="pre">navtools.planning.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">argv</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">list</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#navtools.planning.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses command-line arguments to get the routes file names, and the default speed
to use.</p>
<p>Then use <a class="reference internal" href="#navtools.planning.plan" title="navtools.planning.plan"><code class="xref py py-func docutils literal notranslate"><span class="pre">plan()</span></code></a> to process each file, creating a <code class="file docutils literal notranslate"><em><span class="pre">name</span></em> <span class="pre">Schedule.csv</span></code>
output file with the detailed schedule.</p>
</dd></dl>

</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Navtools</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Overview and Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#actors">Actors</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#use-cases">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#container-overview">Container Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#component-architecture">Component Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#other-notes">Other Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#references">References</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">planning</span></code> – Route Planning Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">analysis</span></code> – Track Analysis Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="opencpn_table.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">opencpn_table</span></code> – OpenCPN Table Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="waypoint_merge.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waypoint_merge</span></code> – Waypoint and Route Merge Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="navigation.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">navigation</span></code> – Navigation Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="lowrance_usr.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">lowrance_usr</span></code> – Lowrance USR File Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="olc.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">olc</span></code> – OLC Geocoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="igrf.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">igrf</span></code> – International Geomagnetic Reference Field</a></li>
<li class="toctree-l1"><a class="reference internal" href="solar.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">solar</span></code> – Sunrise and Sunset</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="introduction.html" title="previous chapter">Overview and Context</a></li>
      <li>Next: <a href="analysis.html" title="next chapter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">analysis</span></code> – Track Analysis Application</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, S.Lott.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/planning.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>