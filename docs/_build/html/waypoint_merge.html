
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>waypoint_merge – Waypoint and Route Merge Application &#8212; Navtools 2021.06.01 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="navigation – Navigation Calculations" href="navigation.html" />
    <link rel="prev" title="opencpn_table – OpenCPN Table Application" href="opencpn_table.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="waypoint-merge-waypoint-and-route-merge-application">
<h1><code class="xref py py-mod docutils literal notranslate"><span class="pre">waypoint_merge</span></code> – Waypoint and Route Merge Application<a class="headerlink" href="#waypoint-merge-waypoint-and-route-merge-application" title="Permalink to this headline">¶</a></h1>
<p>With multiple chart plotters, it’s very easy to have waypoints
defined (or modified) separately. It’s necessary to reconcile
the changes to arrive at a single, comprehensive list of waypoints
that can be then distributed to all devices.</p>
<p>This requires reading and comparing GPX files to arrive at a master
list of waypoints.</p>
<p>Similar analysis must be done for routes to accomodate changes.</p>
<p>Here’s the structure of this application</p>
<p class="plantuml">
<img src="_images/plantuml-2ec3707b91c6a9eed2642576f034bfb19aa06f72.png" alt="&#64;startuml
component waypoint_merge {
    class Waypoint_Plot
    class History
    History *-- &quot;2&quot; Waypoint_Plot
    class WP_Match {
        wp_1: Waypoint_Plot
        wp_2: Waypoint_Plot
    }
    WP_Match::wp_1 -- &quot;?&quot; Waypoint_Plot
    WP_Match::wp_2 -- &quot;?&quot; Waypoint_Plot
}
component navigation {
    class Waypoint {
        lat: Lat
        lon: Lon
    }
}
Waypoint_Plot *-- Waypoint

&#64;enduml"/>
</p>
<p>This module includes several groups of components.</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="#merge-input"><span class="std std-ref">Input Parsing</span></a> group is the functions and classes that
acquire input from the GPX or CSV file.</p></li>
<li><p>The <a class="reference internal" href="#merge-computations"><span class="std std-ref">Processing</span></a> functions work out range and bearing, magnetic bearing, total distance run,
and elapsed time in minutes and hours.</p></li>
<li><p>The <a class="reference internal" href="#merge-output"><span class="std std-ref">Output Writing</span></a> group is the functions to write the CSV result.</p></li>
<li><p>Finally, the <a class="reference internal" href="#merge-cli"><span class="std std-ref">CLI</span></a> components are used
to build a proper command-line application.</p></li>
</ul>
<span class="target" id="module-navtools.waypoint_merge"></span><section id="input-parsing">
<span id="merge-input"></span><h2>Input Parsing<a class="headerlink" href="#input-parsing" title="Permalink to this headline">¶</a></h2>
<p>There are two kinds of inputs</p>
<ul class="simple">
<li><p>GPX files. Each source has a unique logical layout imposed over a common physical format.</p>
<ul>
<li><p>OpenCPN GPX. These tend to be richly detailed, using OpenCPN extensions.</p></li>
<li><p>Chartplotter GPX. These are minimal, skipping import details like GUID’s that
provide unique identity to routes and waypoints.</p></li>
</ul>
</li>
<li><p>USR files. Also called “Lowrance USR files.” These are a binary dump of chartplotter
information.</p></li>
</ul>
<section id="base-classes">
<h3>Base Classes<a class="headerlink" href="#base-classes" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="navtools.waypoint_merge.Waypoint_Plot">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">navtools.waypoint_merge.</span></span><span class="sig-name descname"><span class="pre">Waypoint_Plot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">waypoint:</span> <span class="pre">navtools.navigation.Waypoint</span></em>, <em class="sig-param"><span class="pre">last_updated:</span> <span class="pre">Optional[datetime.datetime]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">sym:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">type:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">None</span></em>, <em class="sig-param"><span class="pre">extensions:</span> <span class="pre">dict</span> <span class="pre">=</span> <span class="pre">&lt;factory&gt;</span></em><span class="sig-paren">)</span><a class="headerlink" href="#navtools.waypoint_merge.Waypoint_Plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Plotted image of a waypoint.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.waypoint_merge.Waypoint_Plot.waypoint">
<span class="sig-name descname"><span class="pre">waypoint</span></span><em class="property"><span class="pre">:</span> <span class="pre">navtools.navigation.Waypoint</span></em><a class="headerlink" href="#navtools.waypoint_merge.Waypoint_Plot.waypoint" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.waypoint_merge.Waypoint_Plot.last_updated">
<span class="sig-name descname"><span class="pre">last_updated</span></span><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">datetime.datetime</span><span class="p"><span class="pre">]</span></span></em><em class="property"> <span class="pre">=</span> <span class="pre">None</span></em><a class="headerlink" href="#navtools.waypoint_merge.Waypoint_Plot.last_updated" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.waypoint_merge.Waypoint_Plot.sym">
<span class="sig-name descname"><span class="pre">sym</span></span><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><em class="property"> <span class="pre">=</span> <span class="pre">None</span></em><a class="headerlink" href="#navtools.waypoint_merge.Waypoint_Plot.sym" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.waypoint_merge.Waypoint_Plot.type">
<span class="sig-name descname"><span class="pre">type</span></span><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></em><em class="property"> <span class="pre">=</span> <span class="pre">None</span></em><a class="headerlink" href="#navtools.waypoint_merge.Waypoint_Plot.type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.waypoint_merge.Waypoint_Plot.extensions">
<span class="sig-name descname"><span class="pre">extensions</span></span><em class="property"><span class="pre">:</span> <span class="pre">dict</span></em><a class="headerlink" href="#navtools.waypoint_merge.Waypoint_Plot.extensions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="input-processing">
<h3>Input Processing<a class="headerlink" href="#input-processing" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="navtools.waypoint_merge.parse_datetime">
<span class="sig-prename descclassname"><span class="pre">navtools.waypoint_merge.</span></span><span class="sig-name descname"><span class="pre">parse_datetime</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">datetime.datetime</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#navtools.waypoint_merge.parse_datetime" title="Permalink to this definition">¶</a></dt>
<dd><p>There are two formats observed:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">2020-09-30T07:52:39Z</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2013-11-08T13:53:42-05:00</span></code></p></li>
</ul>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Refactor to merge with <code class="xref py py-func docutils literal notranslate"><span class="pre">analysis.parse_date()</span></code></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>text</strong> – source text</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>datetime.datetime</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="navtools.waypoint_merge.opencpn_GPX_to_WayPoint">
<span class="sig-prename descclassname"><span class="pre">navtools.waypoint_merge.</span></span><span class="sig-name descname"><span class="pre">opencpn_GPX_to_WayPoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">TextIO</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#navtools.waypoint_merge.Waypoint_Plot" title="navtools.waypoint_merge.Waypoint_Plot"><span class="pre">navtools.waypoint_merge.Waypoint_Plot</span></a><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#navtools.waypoint_merge.opencpn_GPX_to_WayPoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates <a class="reference internal" href="#navtools.waypoint_merge.Waypoint_Plot" title="navtools.waypoint_merge.Waypoint_Plot"><code class="xref py py-class docutils literal notranslate"><span class="pre">Waypoint_Plot</span></code></a> onjects from an OpenCPN GPX doc.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">wpt</span> <span class="n">lat</span><span class="o">=</span><span class="s2">&quot;37.184990000&quot;</span> <span class="n">lon</span><span class="o">=</span><span class="s2">&quot;-76.422203000&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">time</span><span class="o">&gt;</span><span class="mi">2020</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">30</span><span class="n">T07</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">39</span><span class="n">Z</span><span class="o">&lt;/</span><span class="n">time</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">Chisman</span> <span class="n">Creek</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">sym</span><span class="o">&gt;</span><span class="n">anchor</span><span class="o">&lt;/</span><span class="n">sym</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span><span class="n">WPT</span><span class="o">&lt;/</span><span class="nb">type</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">extensions</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">opencpn</span><span class="p">:</span><span class="n">guid</span><span class="o">&gt;</span><span class="mi">34</span><span class="n">de7898</span><span class="o">-</span><span class="n">f37e</span><span class="o">-</span><span class="mi">458</span><span class="n">c</span><span class="o">-</span><span class="mi">8</span><span class="n">ccb</span><span class="o">-</span><span class="n">e4e03fa325ec</span><span class="o">&lt;/</span><span class="n">opencpn</span><span class="p">:</span><span class="n">guid</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">opencpn</span><span class="p">:</span><span class="n">viz_name</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">&lt;/</span><span class="n">opencpn</span><span class="p">:</span><span class="n">viz_name</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">opencpn</span><span class="p">:</span><span class="n">arrival_radius</span><span class="o">&gt;</span><span class="mf">0.050</span><span class="o">&lt;/</span><span class="n">opencpn</span><span class="p">:</span><span class="n">arrival_radius</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">opencpn</span><span class="p">:</span><span class="n">waypoint_range_rings</span> <span class="n">visible</span><span class="o">=</span><span class="s2">&quot;false&quot;</span> <span class="n">number</span><span class="o">=</span><span class="s2">&quot;-1&quot;</span> <span class="n">step</span><span class="o">=</span><span class="s2">&quot;-1&quot;</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;-1&quot;</span> <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;#FFFFFF&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">opencpn</span><span class="p">:</span><span class="n">scale_min_max</span> <span class="n">UseScale</span><span class="o">=</span><span class="s2">&quot;false&quot;</span> <span class="n">ScaleMin</span><span class="o">=</span><span class="s2">&quot;2147483646&quot;</span> <span class="n">ScaleMax</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="n">extensions</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This uses a BUNCH of namespaces</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">xmlns=&quot;http://www.topografix.com/GPX/1/1&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xmlns:gpxx=&quot;http://www.garmin.com/xmlschemas/GpxExtensions/v3&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xmlns:opencpn=&quot;http://www.opencpn.org&quot;</span></code></p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>source</strong> – an open XML file.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An iterator over <code class="xref py py-class docutils literal notranslate"><span class="pre">LogEntry</span></code> objects.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="navtools.waypoint_merge.lowrance_GPX_to_WayPoint">
<span class="sig-prename descclassname"><span class="pre">navtools.waypoint_merge.</span></span><span class="sig-name descname"><span class="pre">lowrance_GPX_to_WayPoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">TextIO</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#navtools.waypoint_merge.Waypoint_Plot" title="navtools.waypoint_merge.Waypoint_Plot"><span class="pre">navtools.waypoint_merge.Waypoint_Plot</span></a><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#navtools.waypoint_merge.lowrance_GPX_to_WayPoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates <a class="reference internal" href="#navtools.waypoint_merge.Waypoint_Plot" title="navtools.waypoint_merge.Waypoint_Plot"><code class="xref py py-class docutils literal notranslate"><span class="pre">Waypoint_Plot</span></code></a> onjects from an Chartplotter GPX doc.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">metadata</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">time</span><span class="o">&gt;</span><span class="mi">2021</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">04</span><span class="n">T16</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">38</span><span class="n">Z</span><span class="o">&lt;/</span><span class="n">time</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">depthunits</span><span class="o">&gt;</span><span class="n">meters</span><span class="o">&lt;/</span><span class="n">depthunits</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">tempunits</span><span class="o">&gt;</span><span class="n">C</span><span class="o">&lt;/</span><span class="n">tempunits</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">sogunits</span><span class="o">&gt;</span><span class="n">m</span><span class="o">/</span><span class="n">s</span><span class="o">&lt;/</span><span class="n">sogunits</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">metadata</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">wpt</span> <span class="n">lon</span><span class="o">=</span><span class="s2">&quot;-80.22695124&quot;</span> <span class="n">lat</span><span class="o">=</span><span class="s2">&quot;25.71541470&quot;</span> <span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">time</span><span class="o">&gt;</span><span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">28</span><span class="n">T19</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">52</span><span class="n">Z</span><span class="o">&lt;/</span><span class="n">time</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">Coconut</span> <span class="n">Grove</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">sym</span><span class="o">&gt;</span><span class="n">anchor</span><span class="o">&lt;/</span><span class="n">sym</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">wpt</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This uses one namespace</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">xmlns=&quot;http://www.topografix.com/GPX/1/1&quot;</span></code></p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>source</strong> – an open XML file.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An iterator over <code class="xref py py-class docutils literal notranslate"><span class="pre">LogEntry</span></code> objects.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="navtools.waypoint_merge.lowrance_USR_to_WayPoint">
<span class="sig-prename descclassname"><span class="pre">navtools.waypoint_merge.</span></span><span class="sig-name descname"><span class="pre">lowrance_USR_to_WayPoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">BinaryIO</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#navtools.waypoint_merge.Waypoint_Plot" title="navtools.waypoint_merge.Waypoint_Plot"><span class="pre">navtools.waypoint_merge.Waypoint_Plot</span></a><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#navtools.waypoint_merge.lowrance_USR_to_WayPoint" title="Permalink to this definition">¶</a></dt>
<dd><p>USR Details</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="n">UUID</span><span class="p">(</span><span class="s1">&#39;41f0e2b8-e631-462a-82fd-f5292523f98d&#39;</span><span class="p">),</span>
<span class="s1">&#39;UID_unit_number&#39;</span><span class="p">:</span> <span class="mi">12988</span><span class="p">,</span>
<span class="s1">&#39;UID_sequence_number&#39;</span><span class="p">:</span> <span class="mi">328</span><span class="p">,</span>
<span class="s1">&#39;waypt_stream_version&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="s1">&#39;waypt_name_length&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
<span class="s1">&#39;waypt_name&#39;</span><span class="p">:</span> <span class="s1">&#39;ALLIGTR C&#39;</span><span class="p">,</span>
<span class="s1">&#39;UID_unit_number_2&#39;</span><span class="p">:</span> <span class="mi">12988</span><span class="p">,</span>
<span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">76.64669528</span><span class="p">,</span>
<span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">24.38829583</span><span class="p">,</span>
<span class="s1">&#39;flags&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
<span class="s1">&#39;icon_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="s1">&#39;color_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="s1">&#39;waypt_description_length&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="s1">&#39;waypt_description&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="s1">&#39;alarm_radius&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="s1">&#39;waypt_creation_date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
<span class="s1">&#39;waypt_creation_time&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">36080</span><span class="p">,</span> <span class="n">microseconds</span><span class="o">=</span><span class="mi">754000</span><span class="p">),</span>
<span class="s1">&#39;unknown_2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="s1">&#39;depth&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="s1">&#39;LORAN_GRI&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;LORAN_Tda&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;LORAN_Tdb&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>source</strong> – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="processing">
<span id="merge-computations"></span><h2>Processing<a class="headerlink" href="#processing" title="Permalink to this headline">¶</a></h2>
<p>This is part of a four-step use case.</p>
<ol class="arabic simple">
<li><p>Dump charplotter-unique waypoints. These are not on the computer, which is the
single source of truth.</p></li>
<li><p>Merge the waypoints, loading OpenCPN. Make manual edits and updates to cleanup and simplify.
Locate “to-be deleted” waypoints. These are duplicates (or near duplicates) that need to
be merged and reconciled. Removing a waypoint can break routes, so route editing is part of
this.</p></li>
<li><p>Dump chartplotter-unique routes (if any.) These are not on the computer, which is the
single source of truth.</p></li>
<li><p>Merge the routes into OpenCPN. Make any manual edits.</p></li>
</ol>
<section id="adjacency">
<h3>Adjacency<a class="headerlink" href="#adjacency" title="Permalink to this headline">¶</a></h3>
<p>While we can use loxodromic distance, this is a lot of computation.</p>
<p>Instead we use OLC. Using truncated OLC permits flexible adjacency via simple string-based processing.
Less math.</p>
<p>See <a class="reference external" href="https://en.m.wikipedia.org/wiki/Open_Location_Code">https://en.m.wikipedia.org/wiki/Open_Location_Code</a></p>
</section>
<section id="classes-and-functions">
<h3>Classes and Functions<a class="headerlink" href="#classes-and-functions" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="navtools.waypoint_merge.History">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">navtools.waypoint_merge.</span></span><span class="sig-name descname"><span class="pre">History</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wp</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#navtools.waypoint_merge.Waypoint_Plot" title="navtools.waypoint_merge.Waypoint_Plot"><span class="pre">navtools.waypoint_merge.Waypoint_Plot</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">matched</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#navtools.waypoint_merge.Waypoint_Plot" title="navtools.waypoint_merge.Waypoint_Plot"><span class="pre">navtools.waypoint_merge.Waypoint_Plot</span></a><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#navtools.waypoint_merge.History" title="Permalink to this definition">¶</a></dt>
<dd><p>The state of the matching operation.
This allows us to track waypoints that have matches.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.waypoint_merge.History.wp">
<span class="sig-name descname"><span class="pre">wp</span></span><em class="property"><span class="pre">:</span> <a class="reference internal" href="#navtools.waypoint_merge.Waypoint_Plot" title="navtools.waypoint_merge.Waypoint_Plot"><span class="pre">navtools.waypoint_merge.Waypoint_Plot</span></a></em><a class="headerlink" href="#navtools.waypoint_merge.History.wp" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.waypoint_merge.History.matched">
<span class="sig-name descname"><span class="pre">matched</span></span><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#navtools.waypoint_merge.Waypoint_Plot" title="navtools.waypoint_merge.Waypoint_Plot"><span class="pre">navtools.waypoint_merge.Waypoint_Plot</span></a><span class="p"><span class="pre">]</span></span></em><em class="property"> <span class="pre">=</span> <span class="pre">None</span></em><a class="headerlink" href="#navtools.waypoint_merge.History.matched" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="navtools.waypoint_merge.WP_Match">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">navtools.waypoint_merge.</span></span><span class="sig-name descname"><span class="pre">WP_Match</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">wp_1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#navtools.waypoint_merge.Waypoint_Plot" title="navtools.waypoint_merge.Waypoint_Plot"><span class="pre">navtools.waypoint_merge.Waypoint_Plot</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wp_2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#navtools.waypoint_merge.Waypoint_Plot" title="navtools.waypoint_merge.Waypoint_Plot"><span class="pre">navtools.waypoint_merge.Waypoint_Plot</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#navtools.waypoint_merge.WP_Match" title="Permalink to this definition">¶</a></dt>
<dd><p>The match result.
There are three states.</p>
<ul class="simple">
<li><p>Both – they passed a comparison test</p></li>
<li><p>1 – From the first source (usually the computer) with no match</p></li>
<li><p>2 – From the second source (usually the chart plotter) with no match</p></li>
</ul>
<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.waypoint_merge.WP_Match.wp_1">
<span class="sig-name descname"><span class="pre">wp_1</span></span><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#navtools.waypoint_merge.Waypoint_Plot" title="navtools.waypoint_merge.Waypoint_Plot"><span class="pre">navtools.waypoint_merge.Waypoint_Plot</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#navtools.waypoint_merge.WP_Match.wp_1" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.waypoint_merge.WP_Match.wp_2">
<span class="sig-name descname"><span class="pre">wp_2</span></span><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#navtools.waypoint_merge.Waypoint_Plot" title="navtools.waypoint_merge.Waypoint_Plot"><span class="pre">navtools.waypoint_merge.Waypoint_Plot</span></a><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#navtools.waypoint_merge.WP_Match.wp_2" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="navtools.waypoint_merge.WP_Match._asdict">
<span class="sig-name descname"><span class="pre">_asdict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#navtools.waypoint_merge.WP_Match._asdict" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new dict which maps field names to their values.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.waypoint_merge.WP_Match._field_defaults">
<span class="sig-name descname"><span class="pre">_field_defaults</span></span><em class="property"> <span class="pre">=</span> <span class="pre">{}</span></em><a class="headerlink" href="#navtools.waypoint_merge.WP_Match._field_defaults" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="navtools.waypoint_merge.WP_Match._fields">
<span class="sig-name descname"><span class="pre">_fields</span></span><em class="property"> <span class="pre">=</span> <span class="pre">('wp_1',</span> <span class="pre">'wp_2')</span></em><a class="headerlink" href="#navtools.waypoint_merge.WP_Match._fields" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="navtools.waypoint_merge.WP_Match._make">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">_make</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iterable</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#navtools.waypoint_merge.WP_Match._make" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a new WP_Match object from a sequence or iterable</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="navtools.waypoint_merge.WP_Match._replace">
<span class="sig-name descname"><span class="pre">_replace</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#navtools.waypoint_merge.WP_Match._replace" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new WP_Match object replacing specified fields with new values</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="navtools.waypoint_merge.match_gen">
<span class="sig-prename descclassname"><span class="pre">navtools.waypoint_merge.</span></span><span class="sig-name descname"><span class="pre">match_gen</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">history_1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">history_2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">list</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Iterator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#navtools.waypoint_merge.WP_Match" title="navtools.waypoint_merge.WP_Match"><span class="pre">navtools.waypoint_merge.WP_Match</span></a><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#navtools.waypoint_merge.match_gen" title="Permalink to this definition">¶</a></dt>
<dd><p>Summarize a pair of match histories as a single sequence of matches.
There are three subtypes of matches.</p>
<ul class="simple">
<li><p>Something was the same.</p></li>
<li><p>Only in the first history list.</p></li>
<li><p>Only in the second history list.</p></li>
</ul>
</dd></dl>

</section>
</section>
<section id="output-writing">
<span id="merge-output"></span><h2>Output Writing<a class="headerlink" href="#output-writing" title="Permalink to this headline">¶</a></h2>
<p>We use Jinja2 to write an XML-format file with the
waypoints that need to be updated in OpenCPN.</p>
<dl class="py function">
<dt class="sig sig-object py" id="navtools.waypoint_merge.waypoint_to_GPX">
<span class="sig-prename descclassname"><span class="pre">navtools.waypoint_merge.</span></span><span class="sig-name descname"><span class="pre">waypoint_to_GPX</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#navtools.waypoint_merge.Waypoint_Plot" title="navtools.waypoint_merge.Waypoint_Plot"><span class="pre">navtools.waypoint_merge.Waypoint_Plot</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">str</span><a class="headerlink" href="#navtools.waypoint_merge.waypoint_to_GPX" title="Permalink to this definition">¶</a></dt>
<dd><p>Inject waypoint data into an XML template.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>source</strong> – source of  Waypoint_Plot instances.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>XML document as text.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="cli">
<span id="merge-cli"></span><h2>CLI<a class="headerlink" href="#cli" title="Permalink to this headline">¶</a></h2>
<p>A typical command looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">navtools</span><span class="o">/</span><span class="n">waypoint_merge</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">p</span> <span class="n">data</span><span class="o">/</span><span class="n">WaypointsRoutesTracks</span><span class="o">.</span><span class="n">usr</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;data/2021 opencpn waypoints.gpx&quot;</span> <span class="o">--</span><span class="n">by</span> <span class="n">name</span> <span class="o">--</span><span class="n">by</span> <span class="n">geocode</span>
</pre></div>
</div>
<p>This produces a report comparing the .USR output from the chartplotter
with the GPX data dumped from OpenCPN. Waypoints are compared by name for literal matches,
then by Geogode for likely matches that have different names.</p>
<p>The output is a list of points that have been created or changed in the
chartplotter, plus a less-interesting list of points that are only
in the computer.</p>
<dl class="py function">
<dt class="sig sig-object py" id="navtools.waypoint_merge.report">
<span class="sig-prename descclassname"><span class="pre">navtools.waypoint_merge.</span></span><span class="sig-name descname"><span class="pre">report</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matches</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#navtools.waypoint_merge.WP_Match" title="navtools.waypoint_merge.WP_Match"><span class="pre">navtools.waypoint_merge.WP_Match</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#navtools.waypoint_merge.report" title="Permalink to this definition">¶</a></dt>
<dd><p>Report on a list of <a class="reference internal" href="#navtools.waypoint_merge.WP_Match" title="navtools.waypoint_merge.WP_Match"><code class="xref py py-class docutils literal notranslate"><span class="pre">WP_Match</span></code></a> instances.
This is a human-readable DIFF-like report.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="navtools.waypoint_merge.main">
<span class="sig-prename descclassname"><span class="pre">navtools.waypoint_merge.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">argv</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">list</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#navtools.waypoint_merge.main" title="Permalink to this definition">¶</a></dt>
<dd><p>Waypoint merge. Parses the command line options.
Compares two files, and emits a report/summary or GPX.</p>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>parameterize the distance or geocode options.</p>
</div>
</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Navtools</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Overview and Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#actors">Actors</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#use-cases">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#container-overview">Container Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#component-architecture">Component Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#other-notes">Other Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#references">References</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="planning.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">planning</span></code> – Route Planning Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">analysis</span></code> – Track Analysis Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="opencpn_table.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">opencpn_table</span></code> – OpenCPN Table Application</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">waypoint_merge</span></code> – Waypoint and Route Merge Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="navigation.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">navigation</span></code> – Navigation Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="lowrance_usr.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">lowrance_usr</span></code> – Lowrance USR File Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="olc.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">olc</span></code> – OLC Geocoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="igrf.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">igrf</span></code> – International Geomagnetic Reference Field</a></li>
<li class="toctree-l1"><a class="reference internal" href="solar.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">solar</span></code> – Sunrise and Sunset</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="opencpn_table.html" title="previous chapter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">opencpn_table</span></code> – OpenCPN Table Application</a></li>
      <li>Next: <a href="navigation.html" title="next chapter"><code class="xref py py-mod docutils literal notranslate"><span class="pre">navigation</span></code> – Navigation Calculations</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, S.Lott.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/waypoint_merge.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>